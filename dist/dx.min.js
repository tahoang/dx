if ("undefined" == typeof _d || !_d) var _d = {
    version: "0.1-dev",
    app: {
        model: {},
        view: {},
        controller: {}
    },
    map: {},
    data: {
        store: {}
    },
    noConflict: function() {
        return _d;
    },
    log: function(e) {
        "undefined" != typeof console && console.log(e);
    },
    application: function(e) {
        this.appInstance = new _d.app.Application(e);
    },
    defineController: function(e, t) {
        var n = this;
        if ("undefined" == typeof t) throw "Can not define controller " + e + ". Prototype is undefined";
        "undefined" == typeof t.extend && (t.extend = _d.app.Controller), t._className = "dx.app.controller." + e, 
        t.name = e, n.app.controller[e] = _d.define(t);
    },
    defineView: function(e, t) {
        var n = this;
        if ("undefined" == typeof t) throw "Can not define view " + e + ". Prototype is undefined";
        "undefined" == typeof t.extend && (t.extend = _d.app.View), t._className = "dx.app.view." + e, 
        t.name = e, n.app.view[e] = _d.define(t);
    },
    defineModel: function(e, t) {
        var n = this;
        if ("undefined" == typeof t) throw "Can not define model " + e + ". Prototype is undefined";
        "undefined" == typeof t.extend && (t.extend = _d.app.Model), t._className = "dx.app.model." + e, 
        t.name = e, n.app.model[e] = _d.define(t);
    },
    defineStore: function(e, t) {
        var n = this;
        if ("undefined" == typeof t) throw "Can not define store " + e + ". Prototype is undefined";
        "undefined" == typeof t.extend && (t.extend = _d.data.Store), t._className = "dx.data.store." + e, 
        t.name = e, n.data.store[e] = _d.define(t);
    },
    getApp: function() {
        return "undefined" != typeof window._appName ? window[window._appName] : void 0;
    },
    getModel: function(e) {
        var t = this.getApp()._models;
        if ("undefined" != typeof t) for (var n in t) {
            var o = t[n];
            if (o.name == e) return modelcm;
        }
    },
    getView: function(e) {
        var t = this.getApp()._views;
        if ("undefined" != typeof t) for (var n in t) {
            var o = t[n];
            if (o.name == e) return o;
        }
    },
    getController: function(e) {
        var t = this.getApp()._controllers;
        if ("undefined" != typeof t) for (var n in t) {
            var o = t[n];
            if (o.name == e) return o;
        }
    },
    getStore: function(e) {
        var t = this.getApp()._stores;
        if ("undefined" != typeof t) for (var n in t) {
            var o = t[n];
            if (o.name == e) return o;
        }
    }
};

window.dx = _d, _d.define = function(e) {
    var t = e, n = t.extend, o = null;
    return null == n || "undefined" == typeof n ? (o = function() {
        "undefined" != typeof this.initialize && this.initialize.apply(this, arguments);
    }, o.prototype = t) : (o = function() {
        var e = "function" == typeof this.initialize ? this.initialize : "undefined";
        "function" == typeof e && e.apply(this, arguments);
    }, _d.extend(o, n), _d.copy(o.prototype, t)), o;
}, _d.extend = function(e, t) {
    var n = function() {};
    n.prototype = t.prototype, e.prototype = new n(), e.prototype.constructor = e, e.parent = t.prototype;
}, _d.copy = function(e, t) {
    if (e = e || {}, t) {
        for (var n in t) {
            var o = t[n];
            void 0 !== o && (e[n] = o);
        }
        var a = "function" == typeof window.Event && t instanceof window.Event;
        !a && t.hasOwnProperty && t.hasOwnProperty("toString") && (e.toString = t.toString);
    }
}, _d.Component = _d.define({
    _className: "dx.Component",
    on: function(e, t) {
        this.events[e] = t;
    },
    initialize: function(e) {
        _d.copy(this, e), this.events = {};
    }
}), _d.app.Application = _d.define({
    name: "Application",
    extend: dx.Component,
    _className: "dx.app.Application",
    initialize: function() {
        dx.Component.prototype.initialize.apply(this, arguments), _d.log("Initializing application " + this.name + "..."), 
        window._appName = this.name, window[this.name] = {
            name: this.name,
            appData: {},
            app: _d.app,
            data: _d.data,
            _stores: [],
            _models: [],
            _views: [],
            _controllers: []
        };
        var e = window[this.name];
        for (var t in this.stores) {
            var n = this.stores[t];
            e._stores.push(new e.data.store[n]());
        }
        for (var t in this.models) {
            var o = this.models[t];
            e._models.push(new e.app.model[o]());
        }
        for (var t in this.views) {
            var a = this.views[t];
            e._views.push(new e.app.view[a]());
        }
        for (var t in this.controllers) {
            var i = this.controllers[t];
            e._controllers.push(new e.app.controller[i]());
        }
        "function" == typeof this.launch && this.launch.apply(this);
    }
}), _d.app.Controller = _d.define({
    extend: dx.Component,
    _className: "dx.app.Controller",
    initialize: function() {
        dx.Component.prototype.initialize.apply(this, arguments);
        for (var e in this.refs) {
            var t = e.toString(), t = t.slice(0, 1).toUpperCase() + t.slice(1, t.length), n = this.refs[e];
            this["get" + t] = function(e) {
                return function(t) {
                    return "undefined" != typeof t ? $(e, t) : $(e);
                };
            }(n);
        }
        for (var e in this.refs) for (var o in this.control) if (e == o) {
            var a = this.control[o];
            for (var i in a) {
                var r = this[a[i]];
                $(document).on(i, this.refs[e], {
                    scope: this,
                    handler: r
                }, function(e) {
                    var t = e.data.scope, n = e.data.handler;
                    "undefined" == typeof n ? log("no event handler found for " + e.type + " on  " + e.target) : "function" == typeof n && n.call(t, e, this);
                });
            }
        }
        _d.log("initialized controller: " + this.name);
    },
    getFormData: function(e) {
        var t;
        if (t = "string" == typeof e ? $(e).serializeArray() : e.serializeArray(), 0 != t.length) {
            var n = {};
            for (var o in t) {
                var a = t[o], i = [];
                for (var r in t) {
                    var s = t[r];
                    a.name == s.name && i.push(s.value);
                }
                n[a.name] = i.length > 1 ? i : a.value;
            }
            return n;
        }
    },
    getDataStore: function() {
        return "undefined" != typeof this.dataStore ? _d.getStore(this.dataStore) : null;
    },
    getRef: function(e) {
        return "undefined" != typeof this.refs[e] ? this.refs[e] : void 0;
    },
    refs: {},
    control: {}
}), _d.app.Model = _d.define({
    extend: dx.Component,
    _className: "dx.app.Model",
    initialize: function() {
        dx.Component.prototype.initialize.apply(this, arguments);
    },
    fields: {}
}), _d.app.View = _d.define({
    extend: dx.Component,
    _className: "dx.app.View",
    initialize: function() {
        dx.Component.prototype.initialize.apply(this, arguments);
    }
}), _d.data.Store = _d.define({
    extend: dx.Component,
    _className: "dx.data.Store",
    model: "",
    dataRoot: "",
    type: "json",
    autoLoad: !1,
    initialize: function(e) {
        dx.Component.prototype.initialize.apply(this, arguments), "function" == typeof this.init && this.init.apply(this, e), 
        this.autoLoad && this.loadJson(), _d.log("initialized store: " + this.name);
    },
    loadJson: function(e) {
        var t = this;
        if ("function" == typeof this.events.beforeLoad && this.events.beforeLoad.call(t, this), 
        "undefined" == typeof this.url) return _d.log("No url was defined. " + this._className + ".loadJson()"), 
        void 0;
        var n = function(e) {
            if ("" != t.dataRoot && (e = e[t.dataRoot]), t.originalData = e, "" != t.model) {
                var n = new ESRGC.Model[t.model]();
                t.data = [];
                for (var o in e) {
                    var a = e[o], i = {};
                    for (var r in n.fields) {
                        var s = n.fields[r], d = s.type, f = a[s.name];
                        switch (d) {
                          case "string":
                            i[s.name] = new String(f);
                            break;

                          case "int":
                            i[s.name] = new Number(f);
                            break;

                          case "date":
                            i[s.name] = new Date(f);
                            break;

                          case "boolean":
                            i[s.name] = new Boolean(f);
                        }
                    }
                    t.data.push(i);
                }
            }
            "function" == typeof t.events.load && t.events.load.call(t, t, e);
        }, o = function() {
            "function" == typeof t.errorCallback ? t.errorCallback.call(t) : alert("An error has occured. Store." + t.name + ".loadJson()");
        };
        if ("undefined" == typeof e || "get" == e) {
            var a = this.constructParams();
            $.getJSON(a, n).error(o);
        } else "post" == e && $.post(this.url, this.params, n).error(o);
    },
    loadContent: function(e) {
        var t = this;
        if ("function" == typeof this.events.beforeLoad && this.events.beforeLoad.call(t, this), 
        "undefined" == typeof this.url) return _d.log("No url was defined. " + this.CLASSNAME + ".loadContent()"), 
        void 0;
        var n = function(e) {
            "function" == typeof t.events.load && t.events.load.call(t, t, e);
        }, o = function() {
            "undefined" != typeof t.errorCallback ? t.errorCallback.call(t) : alert("An error has occured. Store." + t.name + ".loadContent(). Url: " + t.url);
        };
        if ("undefined" == typeof e || "get" == e) {
            var a = this.constructParams();
            $.get(a, n).error(o);
        } else "post" == e && $.post(this.url, this.params, n).error(o);
    },
    loadContentUrl: function(e) {
        var t = this;
        if ("function" == typeof this.events.beforeLoad && this.events.beforeLoad.call(t, this), 
        "undefined" == typeof e) return _d.log("No url was defined. " + this.CLASSNAME + ".loadContentUrl()"), 
        void 0;
        var n = function(e) {
            "function" == typeof t.events.load && t.events.load.call(t, t, e);
        }, o = function() {
            "undefined" != typeof t.errorCallback ? t.errorCallback.call(t) : alert("An error has occured. Store." + t.name + ".loadContentUrl()");
        };
        $.get(e, n).error(o);
    },
    constructParams: function(e) {
        var t = [];
        for (var n in this.params) {
            var o = this.params[n];
            if (o instanceof Array) for (var a in o) t.push(n + "=" + o[a]); else t.push(n + "=" + o);
        }
        return "undefined" == typeof e && (e = this.url), e += "?" + t.join("&"), "jsonp" == this.type && (e += "&outFields=&f=json&callback=?"), 
        e;
    },
    setParams: function(e) {
        this.params = e;
    },
    getParams: function() {
        return this.params;
    },
    getData: function() {
        return "undefined" != typeof this.data ? this.data : (_d.log("store " + this.ClassName + " has no data"), 
        void 0);
    },
    getResponseData: function() {
        return "undefined" != typeof this.originalData ? this.originalData : (_d.log("store " + this.ClassName + " has no response data"), 
        void 0);
    },
    getRecord: function(e, t) {
        if ("undefined" != typeof this.data) for (var n in this.data) {
            var o = this.data[n];
            if (o[e] == t) return o;
        }
    }
}), dx.map.MapViewer = dx.define({
    name: "MapViewer",
    extend: "dx.Component",
    _className: "dx.map.MapViewer",
    initialize: function() {
        dx.Component.prototype.initialize.apply(this, arguments);
    },
    zoomToExtent: function(e) {
        this.map.fitBounds(new L.LatLngBounds(new L.LatLng(e.xmin, e.ymin), new L.LatLng(e.xmax, e.ymax)));
    },
    zoomToFullExtent: function() {},
    zoomToPoint: function(e, t) {
        this.map.setView(new L.LatLng(t, e), this.map.getMaxZoom() - 2);
    },
    zoomIn: function() {
        this.map.zoomIn();
    },
    zoomOut: function() {
        this.map.zoomOut();
    },
    zoomToDataExtent: function() {},
    panTo: function(e, t) {
        this.map.panTo(new L.LatLng(t, e));
    },
    locate: function() {
        this.map.locateAndSetView(this.map.getMaxZoom() - 2);
    }
}), dx.map.LeafletViewer = dx.define({
    name: "LeafletViewer",
    extend: dx.map.MapViewer,
    _className: "LeafletViewer",
    initialize: function() {
        dx.map.MapViewer.prototype.initialize.apply(this, arguments);
        var e = "http://{s}.tile.cloudmade.com/c0925b1494384159af7cd710aadbda8d/997/256/{z}/{x}/{y}.png", t = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://cloudmade.com">CloudMade</a>', n = new L.TileLayer(e, {
            attribution: t,
            maxZoom: 18
        }), o = "http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", a = "Map data © OpenStreetMap contributors", i = new L.TileLayer(o, {
            minZoom: 1,
            maxZoom: 18,
            attribution: a
        });
        this.features = new L.FeatureGroup([]), this.geoJsonFeatures = L.geoJson(), this.map = L.map("map", {
            layers: [ i, this.features, this.geoJsonFeatures ],
            center: this.center || new L.LatLng(39, -76.7),
            zoom: this.zoomLevel || 7,
            measureControl: !0
        });
        var r = {
            CloudMade: n,
            OpenStreetMap: i
        };
        if ("undefined" != typeof this.baseLayers) for (var s in this.baseLayers) {
            var d = this.baseLayers[s];
            void 0 !== d && (r[s] = d);
        }
        var f = {
            Overlays: this.geoJsonFeatures
        };
        if ("undefined" != typeof this.overlays) for (var s in this.overlays) {
            var d = this.overlays[s];
            f[s] = d;
        }
        L.control.layers(r, f).addTo(this.map), L.control.scale().addTo(this.map);
    },
    addGeoJsonLayer: function(e, t) {
        return "undefined" == typeof e ? (dx.log("No data found"), void 0) : (dx.log("Adding data to map..."), 
        "undefined" != this.geoJsonFeatures && ("undefined" == typeof t ? this.geoJsonFeatures.addLayer(L.geoJson(e)) : this.geoJsonFeatures.addLayer(L.geoJson(e, t))), 
        void 0);
    },
    clearGeoJsonFeatures: function() {
        "undefined" != this.geoJsonFeatures && this.geoJsonFeatures.clearLayers();
    },
    addFeatureToFeatureGroup: function(e) {
        var t = this.features;
        return "undefined" == typeof t ? (dx.log("No feature group found"), void 0) : (null != e && t.addLayer(e), 
        void 0);
    },
    clearFeatures: function() {
        var e = this.features;
        return "undefined" == typeof e ? (dx.log("No feature group found"), void 0) : (e.clearLayers(), 
        void 0);
    },
    createFeature: function(e) {
        var t = new Wkt.Wkt();
        t.read(e);
        var n = t.toObject();
        return n;
    },
    getFeaturesBound: function() {
        var e = this.features;
        return "undefined" == typeof e ? (dx.log("No feature group found"), void 0) : e.getBounds();
    },
    getGeoJsonFeaturesBound: function() {
        var e = this.geoJsonFeatures;
        return "undefined" == typeof e ? (dx.log("No geojson feature found"), void 0) : e.getBounds();
    },
    zoomToFeatures: function() {
        var e = this.getFeaturesBound();
        "undefined" != typeof e && this.map.fitBounds(e);
    },
    zoomToGeoJsonFeatures: function() {
        var e = this.getGeoJsonFeaturesBound();
        "undefined" != typeof e && this.map.fitBounds(e);
    },
    zoomToPoint: function(e, t) {
        var n = t || this.getMaxZoom();
        if ("undefined" != typeof e.x && "undefined" != typeof e.y) {
            var o = new L.LatLng(e.x, e.y);
            this.map.setView(o, n);
        } else this.map.setView(e, n);
    }
});